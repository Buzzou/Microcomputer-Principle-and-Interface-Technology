;=========================================================
; 文件名: BUJIN.ASM
; 功能描述: 步进电机控制实验
;=========================================================

IOY0         EQU   0600H          ;片选IOY0对应的端口始地址
MY8255_A     EQU   IOY0+00H*2     ;8255的A口地址
MY8255_B     EQU   IOY0+01H*2     ;8255的B口地址
MY8255_C     EQU   IOY0+02H*2     ;8255的C口地址
MY8255_MODE  EQU   IOY0+03H*2     ;8255的控制寄存器地址

SSTACK	SEGMENT STACK
		DW 256 DUP(?)
SSTACK	ENDS
DATA	SEGMENT
TABDT	DB 01H,03H,02H,06H,04H,0CH,08H,09H
TABDT1  DB 09H,08H,0CH,04H,06H,02H,03H,01H  
DATA	ENDS
CODE	SEGMENT
		ASSUME CS:CODE, DS:DATA
START:	MOV AX, DATA
		MOV DS, AX
MAIN:	MOV AL, 90H			; 控制B口工作于方式0，输出 1001 0000
		MOV DX, MY8255_MODE
		OUT DX, AL
		
L3:		MOV CX,00FH
L1:		MOV BX, OFFSET TABDT
		PUSH CX
		MOV CX, 0008H
A2:		MOV	AL,[BX]
		MOV DX, MY8255_B	; 写B口 
		OUT	DX, AL
		CALL DALLY			; 控制步进电机的转速 
		INC	BX 
		LOOP A2
		POP CX
		LOOP L1
		
		MOV CX,0FH
L2:		MOV BX, OFFSET TABDT1
		PUSH CX
		MOV CX, 0008H
A4:		MOV	AL,[BX]
		MOV DX, MY8255_B	; 写B口 
		OUT	DX, AL
		CALL DALLY			; 控制步进电机的转速 
		INC	BX 
		LOOP A4
		POP CX
		LOOP L2
		JMP L3
		
DALLY:	PUSH CX
		MOV CX,2000H
A5:		PUSH AX
		POP	AX
		LOOP A5
		POP	CX
		RET	
CODE	ENDS
		END START
